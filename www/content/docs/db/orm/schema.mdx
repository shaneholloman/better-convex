---
title: Schema Definition
description: Define tables, relations, and type-safe schemas with Better-Convex ORM
links:
  doc: https://orm.drizzle.team/docs/sql-schema-declaration
---

import { InfoIcon, CheckCircle, AlertTriangle } from "lucide-react"

Define your schema with Drizzle‑style table builders and relations. Better‑Convex keeps the API familiar while adapting it to Convex’s document model.

## Overview

| Feature | Drizzle v1 | Better‑Convex |
|---|---|---|
| Table definition | `pgTable()` | `convexTable()` |
| Relations | `defineRelations()` | `defineRelations()` |
| Type inference | Automatic | Automatic |
| Field types | Column builders | Column builders |

## Table Definition

```ts title="convex/schema.ts"
import { convexTable, text, integer, boolean, id } from 'better-convex/orm';

export const users = convexTable('users', {
  name: text().notNull(),
  email: text().notNull(),
  age: integer(),
  isAdmin: boolean(),
});
```

**Auto‑generated fields:**
- `_id: Id<'table'>`
- `_creationTime: number`

### Nullability

Fields are nullable by default. Add `.notNull()` for required fields.

```ts
const users = convexTable('users', {
  name: text().notNull(), // string
  bio: text(),            // string | null
});
```

### Column Builder Types

| TypeScript Type | Builder |
|---|---|
| `string` \| `null` | `text()` |
| `string` | `text().notNull()` |
| `number` \| `null` | `integer()` or `number()` |
| `number` | `integer().notNull()` or `number().notNull()` |
| `boolean` \| `null` | `boolean()` |
| `boolean` | `boolean().notNull()` |
| `bigint` \| `null` | `bigint()` |
| `Id<'users'>` \| `null` | `id('users')` |
| `Id<'users'>` | `id('users').notNull()` |
| `number[]` \| `null` | `vector(1536)` |
| `number[]` | `vector(1536).notNull()` |

See [Column Types](/docs/db/orm/column-types) for the full Better-Convex builder reference and Drizzle mapping notes.

## Relations

Use Drizzle‑style `defineRelations()` with `_id` references.

```ts title="convex/schema.ts"
import { defineRelations, extractRelationsConfig } from 'better-convex/orm';

export const posts = convexTable('posts', {
  title: text().notNull(),
  authorId: id('users'),
});

export const ormSchema = defineRelations({ users, posts }, (r) => ({
  users: { posts: r.many.posts() },
  posts: {
    author: r.one.users({ from: r.posts.authorId, to: r.users._id }),
  },
}));

export const ormEdges = extractRelationsConfig(ormSchema);
```

## Schema Options

`defineSchema` accepts Convex schema options plus Better‑Convex runtime guardrail options.

```ts
import { defineSchema } from 'better-convex/orm';

export default defineSchema({ users, posts }, { strict: false });
```

- `strict` (default `true`): missing indexes throw unless `allowFullScan: true`.
- `strict: false`: missing indexes still require `allowFullScan: true`, with fewer warnings.

### Runtime Defaults

Use `defaults` to set global runtime guardrails.

```ts
export default defineSchema({ users, posts }, {
  strict: true,
  defaults: {
    defaultLimit: 100,      // non-paginated findMany() fallback
    mutationBatchSize: 100, // update/delete fetch batch size
    mutationMaxRows: 1000,  // max rows matched by update/delete
  },
});
```

- `defaults.defaultLimit`: used when `findMany()` is non-paginated and `limit` is omitted.
- `defaults.defaultLimit`: used when `findMany()` is non-paginated and `limit` is omitted. No implicit built-in fallback is applied when this is unset.
- `defaults.mutationBatchSize`: page size used to collect rows for `update()`/`delete()`. Built-in fallback: `100`.
- `defaults.mutationMaxRows`: hard cap for matched rows in `update()`/`delete()`. Built-in fallback: `1000`.
- All defaults must be positive integers.

### Strict Policy (Guardrails)

Strict guardrails now cover relation indexes, predicate where(), and unbounded update/delete.

| Area | Current (2026‑02‑06) | Strict `true` | Strict `false` |
|---|---|---|---|
| Relation loading missing index | throws unless `allowFullScan` | throws unless `allowFullScan`; warns when scanning | throws unless `allowFullScan`; no strict warning |
| Predicate `where` | throws unless `allowFullScan` | throws unless `allowFullScan`; warns when scanning | throws unless `allowFullScan`; warns when scanning |
| Pagination orderBy missing index | warn + fallback to `_creationTime` | warn + fallback | warn + fallback |
| Unsized non-paginated `findMany()` | throws unless `limit`/`paginate`/`defaultLimit`/`allowFullScan` | same | same |
| `many()` relation without per-parent limit | throws unless relation `limit`/`defaultLimit`/`allowFullScan` | same | same |
| Update/delete without `where()` | throws unless `allowFullScan` | throws unless `allowFullScan`; warns when scanning | throws unless `allowFullScan`; no strict warning |
| Update/delete row count exceeds `mutationMaxRows` | throws | throws | throws |

## Indexes

Add indexes for fields you filter or sort by.

```ts
import { convexTable, text, id, index } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    title: text().notNull(),
    authorId: id('users'),
  },
  (t) => [index('by_author').on(t.authorId)]
);
```

### Search Indexes

```ts
import { convexTable, text, id, searchIndex } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    title: text().notNull(),
    authorId: id('users'),
  },
  (t) => [searchIndex('by_text').on(t.title).filter(t.authorId)]
);
```

### Vector Indexes (wip)

```ts
import { convexTable, id, vector, vectorIndex } from 'better-convex/orm';

const posts = convexTable(
  'posts',
  {
    authorId: id('users'),
    embedding: vector(1536).notNull(),
  },
  (t) => [
    vectorIndex('embedding_vec')
      .on(t.embedding)
      .dimensions(1536)
      .filter(t.authorId),
  ]
);
```

Better‑Convex mirrors Convex’s vector search API with Drizzle‑style builders. Use `vector(dimensions)` for embedding fields.

**Common errors:**
- Missing `.on(...)` → "Did you forget to call .on(...)?"
- Missing `.dimensions(n)` on vector indexes → "missing dimensions"

## Constraints And Defaults

- Defaults set with `.default(...)` and `$defaultFn(...)` are applied by Better‑Convex inserts
- `$onUpdateFn(...)` columns are applied on updates (and can also fill missing values on insert)
- `unique()` and column `.unique()` are enforced at runtime (ORM mutations only)
- `foreignKey()` and column `.references()` are enforced at runtime (ORM mutations only)
- `check()` constraints are enforced at runtime (ORM mutations only)

<Callout icon={<AlertTriangle />}>
Constraints and defaults are enforced only by ORM mutations. Direct `ctx.db` writes bypass these checks. For foreign key actions (`cascade`, `restrict`, `set null`, `set default`), add an index on the referencing columns.
</Callout>

## Common Gotchas

| Issue | Fix |
|---|---|
| Defining `_id` manually | Convex creates `_id` automatically |
| Fields unexpectedly nullable | Use `.notNull()` |
| Relations not loading | Define both sides and export `ormEdges` |
| Slow ordering | Add `index('...').on(t.field)` for the primary `orderBy` field |

## Next Steps

<Cards>
  <Card title="Column Types" href="/docs/db/orm/column-types">
    Builders and TypeScript types
  </Card>
  <Card title="Indexes & Constraints" href="/docs/db/orm/indexes-constraints">
    Indexes, unique constraints, and foreign keys
  </Card>
  <Card title="Relations" href="/docs/db/orm/relations">
    One‑to‑one, one‑to‑many, many‑to‑many
  </Card>
  <Card title="Querying Data" href="/docs/db/orm/queries">
    Filters, ordering, pagination
  </Card>
  <Card title="API Reference" href="/docs/db/orm/api-reference">
    Full API surface
  </Card>
  <Card title="Limitations" href="/docs/db/orm/limitations">
    Differences and tradeoffs
  </Card>
</Cards>
