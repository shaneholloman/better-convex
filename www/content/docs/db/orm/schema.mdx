---
title: Schema Definition
description: Define tables, relations, and type-safe schemas with Better-Convex ORM
links:
  doc: https://orm.drizzle.team/docs/sql-schema-declaration
---

import { InfoIcon, CheckCircle, AlertTriangle } from "lucide-react"

Define your database schema using Drizzle-style table definitions and relations. Better-Convex ORM provides full type safety from schema to queries.

## Overview

**Category**: ✅ 100% Compatible

Schema definition in Better-Convex ORM mirrors Drizzle's approach:

| Feature | Drizzle | Better-Convex | Compatibility |
|---------|---------|---------------|---------------|
| Table definition | `pgTable()` | `convexTable()` | ✅ API identical |
| Relations | `relations()` | `relations()` | ✅ API identical |
| Type inference | Automatic | Automatic | ✅ Same behavior |
| Field types | Column builders | Convex validators | ⚠️ Different syntax (M1-M5) |

## Table Definition

### Basic Tables

Define tables using `convexTable()` with Convex validators:

```ts title="convex/schema.ts" showLineNumbers {1-2,4-9}
import { convexTable, relations, text, integer } from 'better-convex/orm';

const users = convexTable('users', {
  name: text().notNull(),
  email: text().notNull(),
  age: integer(),
  role: text().$type<'user' | 'admin'>().notNull(),
});
```

**Type Inference:**
```ts
// Automatically inferred type:
{
  _id: Id<'users'>,
  name: string,
  email: string,
  age?: number,
  role: 'user' | 'admin',
  _creationTime: number
}
```

<Callout icon={<InfoIcon />}>
**Column Builders**: Better-Convex ORM uses Drizzle-style column builders (`text()`, `integer()`, `boolean()`) for familiar ergonomics with Convex's type inference.
</Callout>

**Key Differences from Drizzle:**
- **No manual ID field**: Convex auto-creates `_id: Id<'users'>` for every document
- **Nullable by default**: Fields are nullable unless you add `.notNull()` modifier
- **Type constraints**: Use `.$type<T>()` for literal types like enums

### Column Builder Types

| TypeScript Type | Better-Convex Builder | Drizzle Equivalent |
|-----------------|----------------------|---------------------|
| `string \| null` | `text()` | `text()` |
| `string` | `text().notNull()` | `text().notNull()` |
| `number \| null` | `integer()` or `number()` | `integer()` or `real()` |
| `number` | `integer().notNull()` | `integer().notNull()` |
| `boolean \| null` | `boolean()` | `boolean()` |
| `'a' \| 'b'` | `text().$type<'a' \| 'b'>().notNull()` | `text().$type<'a' \| 'b'>()` |
| `Array<string>` | Complex validators (see below) | `text().array()` |
| `{ x: number }` | Complex validators (see below) | Not directly supported |
| `Id<'users'>` | `id('users')` | `serial()` or `uuid()` |

### Negative Examples

```ts
// ❌ WRONG: Mixing type annotations
const users = convexTable('users', {
  age: integer() | undefined, // Type error!
});

// ✅ CORRECT: Builders are nullable by default
const users = convexTable('users', {
  age: integer(), // Already nullable
});

// ❌ WRONG: Trying to define _id manually
const users = convexTable('users', {
  _id: id('users'), // Don't do this!
  name: text().notNull(),
});

// ✅ CORRECT: _id is auto-created
const users = convexTable('users', {
  name: text().notNull(),
});
```

## Relations

### One-to-Many Relations

Define relations using Drizzle's `relations()` API:

```ts title="convex/schema.ts" showLineNumbers {12-18,20-26}
import { convexTable, relations, text } from 'better-convex/orm';

const users = convexTable('users', {
  name: text().notNull(),
});

const posts = convexTable('posts', {
  title: text().notNull(),
});

// "One" side: User has many posts
const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));

// "Many" side: Post belongs to user
const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, {
    fields: [posts.userId],
    references: [users._id],
  }),
}));

export const schema = {
  users,
  posts,
  usersRelations,
  postsRelations,
};
```

<Callout icon={<CheckCircle />}>
**✅ API Compatibility: 100%** - The relations API is identical to Drizzle ORM. Code that defines relations in Drizzle works in Better-Convex.
</Callout>

### Many-to-Many Relations

```ts title="convex/schema.ts" showLineNumbers
import { convexTable, relations, text } from 'better-convex/orm';

const posts = convexTable('posts', {
  title: text().notNull(),
});

const tags = convexTable('tags', {
  name: text().notNull(),
});

// Define many:many relations
const postsRelations = relations(posts, ({ many }) => ({
  tags: many(tags),
}));

const tagsRelations = relations(tags, ({ many }) => ({
  posts: many(posts),
}));
```

**Behind the scenes:**
```ts
// Convex automatically creates join edges:
// posts -> tags (via postsTags edge)
// tags -> posts (via tagsPosts edge)
```

### Self-Referencing Relations

```ts title="convex/schema.ts" showLineNumbers
import { convexTable, relations, text } from 'better-convex/orm';

const users = convexTable('users', {
  name: text().notNull(),
});

const usersRelations = relations(users, ({ many }) => ({
  followers: many(users, { relationName: 'followers' }),
  following: many(users, { relationName: 'following' }),
}));
```

## Type Inference

### Automatic Type Inference

Better-Convex ORM infers types from your schema:

```ts
import { convexTable, text, integer } from 'better-convex/orm';

const users = convexTable('users', {
  name: text().notNull(),
  email: text().notNull(),
  age: integer(),
});

// Type is automatically inferred
type User = typeof users.$inferSelect;
// Result:
// {
//   _id: Id<'users'>,
//   name: string,
//   email: string,
//   age: number | null,
//   _creationTime: number
// }

type NewUser = typeof users.$inferInsert;
// Result:
// {
//   name: string,
//   email: string,
//   age?: number
// }
```

### Query Return Type Inference

```ts title="convex/queries.ts"
import { query } from './_generated/server';
import { db } from 'better-convex/orm';
import { eq } from 'better-convex/orm/filter';

export const getAdminUser = query({
  handler: async (ctx) => {
    const user = await db(ctx).query.users.findFirst({
      where: eq(users.role, 'admin'),
    });

    return user;
    // Type automatically inferred:
    // {
    //   _id: Id<'users'>,
    //   name: string,
    //   email: string,
    //   age?: number,
    //   role: 'admin', // Narrowed from 'user' | 'admin'!
    //   _creationTime: number
    // } | null
  },
});
```

<Callout icon={<InfoIcon />}>
**IDE Experience**: Your IDE will provide full autocomplete for table names, field names, and filter operators. Hover over any query result to see the inferred type.
</Callout>


## Unique Constraints

Convex supports unique fields via Convex Ents:

```ts title="convex/schema.ts"
import { defineEnt } from 'convex-ents';
import { v } from 'convex/values';

const users = defineEnt({
  name: v.string(),
})
  .field('email', v.string(), { unique: true })
  .field('username', v.string(), { unique: true });
```

<Callout icon={<AlertTriangle />}>
**⚠️ Limitation**: Unique constraints require using Convex Ents' `defineEnt()` instead of `convexTable()`. This is a Category 2 feature with a workaround.
</Callout>

## Indexes

Indexes are automatically created for relation fields:

```ts
import { convexTable, text } from 'better-convex/orm';

const posts = convexTable('posts', {
  title: text().notNull(),
});

const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, {
    fields: [posts.userId],
    references: [users._id],
  }),
}));

// Convex automatically creates index on userId!
```

For custom indexes, use Convex Ents:

```ts
import { defineEnt } from 'convex-ents';

const posts = defineEnt({
  title: v.string(),
  published: v.boolean(),
  createdAt: v.number(),
})
  .index('published_createdAt', ['published', 'createdAt']);
```

## Common Gotchas

| Issue | Solution |
|-------|----------|
| **Don't manually define `_id`** | Convex auto-creates `_id` for every table |
| **Builders are nullable by default** | Use `.notNull()` modifier for required fields |
| **Relations need BOTH sides defined** | Define relations on both tables for many:many |
| **Export relations in schema** | Both table AND relations object must be exported |
| **Convex uses `null`, not SQL `NULL`** | Nullable fields return `null` when empty |
| **Can't select specific columns** | Convex always returns full documents |

## Next Steps

<Cards>
  <Card title="Relations" href="/docs/db/orm/relations">
    Learn how to define one-to-one, one-to-many, and many-to-many relations
  </Card>
  <Card title="Querying Data" href="/docs/db/orm/queries">
    Master findMany(), findFirst(), and filtering operators
  </Card>
  <Card title="API Reference" href="/docs/db/orm/api-reference">
    Complete API documentation for all ORM features
  </Card>
  <Card title="Limitations" href="/docs/db/orm/limitations">
    Understand current limitations and planned features
  </Card>
</Cards>
